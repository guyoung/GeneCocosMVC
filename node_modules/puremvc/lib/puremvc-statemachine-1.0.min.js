(function(e){function t(e,t,n,r){this.name=e;if(t)this.entering=t;if(n)this.exiting=n;if(r)this.changed=r;this.transitions=new Object}function n(){puremvc.Mediator.call(this,n.NAME,null);this.states={}}function r(e){puremvc.Notifier.call(this);this.fsm=e}if(null==e)e=window;if(e.puremvc.statemachine){return}t.prototype.defineTrans=function(e,t){if(this.getTarget(e)!=null)return;this.transitions[e]=t};t.prototype.removeTrans=function(e){delete this.transitions[e]};t.prototype.getTarget=function(e){return this.transitions[e]?this.transitions[e]:null};t.prototype.name=null;t.prototype.entering=null;t.prototype.exiting=null;t.prototype.changed=null;t.prototype.transitions=null;n.prototype=new puremvc.Mediator;n.prototype.constructor=n;n.prototype.onRegister=function(){if(this.initial)this.transitionTo(this.initial,null)};n.prototype.registerState=function(e,t){if(e==null||this.states[e.name]!=null)return;this.states[e.name]=e;if(t)this.initial=e};n.prototype.removeState=function(e){var t=this.states[e];if(t==null)return;this.states[e]=null};n.prototype.transitionTo=function(e,t){if(e==null)return;this.canceled=false;if(this.getCurrentState()&&this.getCurrentState().exiting)this.sendNotification(this.getCurrentState().exiting,t,e.name);if(this.canceled){this.canceled=false;return}if(e.entering)this.sendNotification(e.entering,t);if(this.canceled){this.canceled=false;return}this.setCurrentState(e);if(e.changed){this.sendNotification(this.getCurrentState().changed,t)}this.sendNotification(n.CHANGED,this.getCurrentState(),this.getCurrentState().name)};n.prototype.listNotificationInterests=function(){return[n.ACTION,n.CANCEL]};n.prototype.handleNotification=function(e){switch(e.getName()){case n.ACTION:var t=e.getType();var r=this.getCurrentState().getTarget(t);var i=this.states[r];if(i)this.transitionTo(i,e.getBody());break;case n.CANCEL:this.canceled=true;break}};n.prototype.getCurrentState=function(){return this.viewComponent};n.prototype.setCurrentState=function(e){this.viewComponent=e};n.prototype.states=null;n.prototype.initial=null;n.prototype.canceled=null;n.NAME="StateMachine";n.ACTION=n.NAME+"/notes/action";n.CHANGED=n.NAME+"/notes/changed";n.CANCEL=n.NAME+"/notes/cancel";r.prototype=new puremvc.Notifier;r.prototype.constructor=r;r.prototype.inject=function(){var e=new puremvc.statemachine.StateMachine(this.multitonKey);var t=this.getStates();for(var n=0;n<t.length;n++){e.registerState(t[n],this.isInitial(t[n].name))}this.facade.registerMediator(e)};r.prototype.getStates=function(){if(this.stateList==null){this.stateList=[];var e=this.fsm.state?this.fsm.state:[];for(var t=0;t<e.length;t++){var n=e[t];var r=this.createState(n);this.stateList.push(r)}}return this.stateList};r.prototype.createState=function(e){var t=e["@name"];var n=e["@exiting"];var r=e["@entering"];var i=e["@changed"];var s=new puremvc.statemachine.State(t,r,n,i);var o=e.transition?e.transition:[];for(var u=0;u<o.length;u++){var a=o[u];s.defineTrans(a["@action"],a["@target"])}return s};r.prototype.isInitial=function(e){var t=this.fsm["@initial"];return e==t};r.prototype.fsm=null;r.prototype.stateList=null;e.puremvc.statemachine={};e.puremvc.statemachine.State=t;e.puremvc.statemachine.StateMachine=n;e.puremvc.statemachine.FSMInjector=r})(this)
